<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>글 작성 및 목록</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .post { border: 1px solid #ccc; padding: 10px; margin: 10px 0; cursor: pointer; }
    .post.selected { background: #e6f7ff; }
    .button-group { margin-top: 10px; }
    video, img { max-width: 100%; margin-top: 10px; }
  </style>
</head>
<body>

<h2>비밀번호 입력</h2>
<input type="password" id="passwordInput" placeholder="비밀번호 입력" />
<div class="button-group">
  <button onclick="goToEditor()">글쓰기</button>
  <button onclick="goToEditorForEdit()">선택한 글 수정</button>
</div>

<hr />

<h2>글 목록</h2>
<div id="postList"></div>

<script>
  const ADMIN_PASSWORD = "mypassword123";  // 고정된 비밀번호
  const passwordInput = document.getElementById('passwordInput');
  const postList = document.getElementById('postList');
  let selectedPostId = null;

  function goToEditor() {
    const pwd = passwordInput.value;
    if (pwd !== ADMIN_PASSWORD) {
      alert("비밀번호가 틀렸습니다.");
      return;
    }
    localStorage.removeItem('editingPostId');
    window.location.href = "edit.html";
  }

  function goToEditorForEdit() {
    const pwd = passwordInput.value;
    if (pwd !== ADMIN_PASSWORD) {
      alert("비밀번호가 틀렸습니다.");
      return;
    }
    if (selectedPostId === null) {
      alert("수정할 글을 선택하세요.");
      return;
    }
    localStorage.setItem('editingPostId', selectedPostId);
    window.location.href = "edit.html";
  }

  function loadPosts() {
    const posts = JSON.parse(localStorage.getItem('posts') || '[]');
    postList.innerHTML = "";

    posts.forEach((post) => {
      const div = document.createElement('div');
      div.className = "post";
      div.innerHTML = `<strong>${post.title}</strong><br/><div>${post.content}</div>`;

      (post.attachments || []).forEach(data => {
        const media = document.createElement(data.startsWith("data:video") ? "video" : "img");
        media.src = data;
        if (media.tagName === "VIDEO") media.controls = true;
        media.style.maxWidth = "100%";
        div.appendChild(media);
      });

      div.onclick = () => {
        document.querySelectorAll('.post').forEach(p => p.classList.remove('selected'));
        div.classList.add('selected');
        selectedPostId = post.id;
      };

      postList.appendChild(div);
    });
  }

  loadPosts();
</script>

</body>
</html>
